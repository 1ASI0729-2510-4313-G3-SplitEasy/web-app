import{a as dt,b as ut}from"./chunk-D2AGE2H7.js";import{Ga as W,Ha as ct,L as B,Z as ot,b as v,c as it,d as R,fa as at,g as A,ga as rt,ha as st,i as E,ia as mt,j as nt,ja as lt,n as y,t as q,ua as M,va as pt}from"./chunk-LGLNOSSO.js";import{$ as X,$b as O,Bb as i,Cb as e,Db as D,Hb as Z,Lb as F,Mb as S,Oa as r,Q as P,Ta as _,Xb as n,Yb as u,Zb as g,_b as tt,a as N,aa as Y,ab as C,ac as H,b as V,bb as T,bc as k,dc as z,ec as et,fc as I,gb as f,nc as h,oc as L,pc as x,rb as d}from"./chunk-OPWL5SPH.js";var xt=(o,a)=>({"bg-success":o,"bg-warning":a});function yt(o,a){o&1&&(i(0,"tr")(1,"th"),n(2,"Factura"),e(),i(3,"th"),n(4,"Descripci\xF3n"),e(),i(5,"th"),n(6,"Monto"),e(),i(7,"th"),n(8,"Estrategia"),e(),i(9,"th"),n(10,"Fecha l\xEDmite"),e(),i(11,"th"),n(12,"Estado"),e(),i(13,"th"),n(14,"Acciones"),e()())}function St(o,a){if(o&1){let t=Z();i(0,"button",8),F("click",function(){X(t);let b=S().$implicit,m=S(2);return Y(m.pagar(b))}),n(1," Pagar "),e()}}function It(o,a){o&1&&D(0,"i",9)}function vt(o,a){if(o&1&&(i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),h(7,"currency"),e(),i(8,"td"),n(9),e(),i(10,"td"),n(11),h(12,"date"),e(),i(13,"td")(14,"span",5),n(15),e()(),i(16,"td"),f(17,St,2,0,"button",6)(18,It,1,0,"i",7),e()()),o&2){let t=a.$implicit;r(2),u(t.billDescripcion),r(2),u(t.descripcion),r(2),u(L(7,9,t.monto)),r(3),u(t.strategy),r(2),u(x(12,11,t.fechaLimite,"longDate")),r(3),d("ngClass",I(14,xt,t.status==="PAGADO",t.status==="PENDIENTE")),r(),g(" ",t.status," "),r(2),d("ngIf",t.status==="PENDIENTE"),r(),d("ngIf",t.status==="PAGADO")}}function Et(o,a){if(o&1&&(i(0,"p-table",2),f(1,yt,15,0,"ng-template",3)(2,vt,19,17,"ng-template",4),e()),o&2){let t=S();d("value",t.contributions)("paginator",!0)("rows",5)("responsiveLayout","scroll")("showCurrentPageReport",!0)}}var j=class o{constructor(a){this.http=a}userId;contributions=[];isLoading=!0;ngOnInit(){let a=JSON.parse(localStorage.getItem("currentUser"));this.userId=+a.id,this.fetchContributions()}fetchContributions(){this.isLoading=!0,this.http.get(`http://localhost:3000/member_contributions?member_id=${this.userId}`).subscribe(a=>{let t=a.map(s=>s.contribution_id);this.http.get("http://localhost:3000/contributions").subscribe(s=>{this.http.get("http://localhost:3000/bills").subscribe(b=>{this.contributions=a.map(m=>{let p=s.find(c=>c.id==m.contribution_id),l=b.find(c=>c.id==p?.bill_id);return V(N({},m),{descripcion:p?.descripcion,strategy:p?.strategy,fechaLimite:p?.fecha_limite,billDescripcion:l?.descripcion,fechaFactura:l?.fecha,montoFactura:l?.monto})}),this.isLoading=!1})})})}pagar(a){let t=V(N({},a),{status:"PAGADO",pagado_en:new Date().toISOString()});this.http.patch(`http://localhost:3000/member_contributions/${a.id}`,t).subscribe(()=>{this.fetchContributions()})}static \u0275fac=function(t){return new(t||o)(_(y))};static \u0275cmp=C({type:o,selectors:[["app-memb-contributions"]],standalone:!1,decls:2,vars:1,consts:[[1,"p-4","max-w-screen-lg","mx-auto"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} contribuciones",3,"value","paginator","rows","responsiveLayout","showCurrentPageReport",4,"ngIf"],["currentPageReportTemplate","Mostrando {first} a {last} de {totalRecords} contribuciones",3,"value","paginator","rows","responsiveLayout","showCurrentPageReport"],["pTemplate","header"],["pTemplate","body"],[1,"badge",3,"ngClass"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["class","pi pi-check-circle text-success",4,"ngIf"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"pi","pi-check-circle","text-success"]],template:function(t,s){t&1&&(i(0,"div",0),f(1,Et,3,5,"p-table",1),e()),t&2&&(r(),d("ngIf",!s.isLoading))},dependencies:[v,R,B,W,E,A],encapsulation:2})};var Mt=o=>({"font-bold text-primary":o});function Nt(o,a){if(o&1&&(i(0,"li"),n(1),i(2,"span",10),n(3),e()()),o&2){let t=a.$implicit;r(),tt(" ",t.name," (",t.email,") - "),r(),d("ngClass",et(4,Mt,t.role==="REPRESENTANTE")),r(),g(" ",t.role," ")}}function wt(o,a){if(o&1&&(i(0,"div",1)(1,"div",2)(2,"div",3)(3,"p-card",4)(4,"p")(5,"strong"),n(6,"Nombre:"),e(),n(7),e(),i(8,"p")(9,"strong"),n(10,"Moneda:"),e(),n(11),e(),i(12,"p")(13,"strong"),n(14,"Descripci\xF3n:"),e(),n(15),e()()(),i(16,"div",3)(17,"p-card",5)(18,"p")(19,"strong"),n(20,"Total pendiente:"),e(),n(21),h(22,"currency"),e(),i(23,"p")(24,"strong"),n(25,"Total pagado:"),e(),n(26),h(27,"currency"),e(),i(28,"p")(29,"strong"),n(30,"Contribuciones activas:"),e(),n(31),e()()(),i(32,"div",6)(33,"p-card",7)(34,"ul",8),f(35,Nt,4,6,"li",9),e()()()()()),o&2){let t=S();r(7),g(" ",t.household.name,""),r(4),g(" ",t.household.currency,""),r(4),g(" ",t.household.description,""),r(6),g(" ",x(22,7,t.totalPendiente,t.household.currency),""),r(5),g(" ",x(27,10,t.totalPagado,t.household.currency),""),r(5),g(" ",t.contributions.length,""),r(4),d("ngForOf",t.members)}}var G=class o{constructor(a){this.http=a}userId;household=null;members=[];contributions=[];totalPendiente=0;totalPagado=0;ngOnInit(){let a=JSON.parse(localStorage.getItem("currentUser"));this.userId=+a.id,this.http.get(`http://localhost:3000/household_members?user_id=${this.userId}`).subscribe(t=>{let s=t[0]?.household_id;s&&this.http.get(`http://localhost:3000/households?id=${s}`).subscribe(b=>{this.household=b[0];let m=this.household.representante_id;this.http.get(`http://localhost:3000/household_members?household_id=${s}`).subscribe(p=>{let l=p.map(c=>c.user_id);l.includes(m)||l.push(m),this.http.get("http://localhost:3000/users").subscribe(c=>{this.members=c.filter(ft=>l.includes(ft.id))})}),this.http.get(`http://localhost:3000/member_contributions?member_id=${this.userId}`).subscribe(p=>{this.contributions=p,this.totalPendiente=p.filter(l=>l.status==="PENDIENTE").reduce((l,c)=>l+(Number(c.monto)||0),0),this.totalPagado=p.filter(l=>l.status==="PAGADO").reduce((l,c)=>l+(Number(c.monto)||0),0)})})})}static \u0275fac=function(t){return new(t||o)(_(y))};static \u0275cmp=C({type:o,selectors:[["app-memb-home"]],standalone:!1,decls:1,vars:1,consts:[["class","p-4 max-w-screen-lg mx-auto",4,"ngIf"],[1,"p-4","max-w-screen-lg","mx-auto"],[1,"grid","mt-3"],[1,"col-12","md:col-6","p-1"],["header","Mi hogar"],["header","Mi situaci\xF3n financiera"],[1,"col-12","p-1"],["header","Miembros del hogar"],[1,"list-disc","pl-4"],[4,"ngFor","ngForOf"],[3,"ngClass"]],template:function(t,s){t&1&&f(0,wt,36,13,"div",0),t&2&&d("ngIf",s.household)},dependencies:[v,it,R,M,E],encapsulation:2})};var Pt=(o,a)=>({"bg-success":o,"bg-warning":a});function Tt(o,a){o&1&&(i(0,"tr")(1,"th"),n(2,"Factura"),e(),i(3,"th"),n(4,"Descripci\xF3n"),e(),i(5,"th"),n(6,"Estrategia"),e(),i(7,"th"),n(8,"Monto"),e(),i(9,"th"),n(10,"Fecha l\xEDmite"),e(),i(11,"th"),n(12,"Estado"),e(),i(13,"th"),n(14,"Pagado en"),e()())}function Dt(o,a){if(o&1&&(i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),e(),i(7,"td"),n(8),h(9,"currency"),e(),i(10,"td"),n(11),h(12,"date"),e(),i(13,"td")(14,"span",5),n(15),e()(),i(16,"td"),n(17),h(18,"date"),e()()),o&2){let t=a.$implicit;r(2),u(t.descripcionFactura),r(2),u(t.descripcionContrib),r(2),u(t.strategy),r(2),u(L(9,8,t.monto)),r(3),u(x(12,10,t.fechaLimite,"longDate")),r(3),d("ngClass",I(16,Pt,t.status==="PAGADO",t.status==="PENDIENTE")),r(),g(" ",t.status," "),r(2),u(t.pagadoEn?x(18,13,t.pagadoEn,"short"):"-")}}var $=class o{constructor(a){this.http=a}userId;statusList=[];ngOnInit(){let a=JSON.parse(localStorage.getItem("currentUser"));this.userId=+a.id,this.loadStatus()}loadStatus(){this.http.get(`http://localhost:3000/member_contributions?member_id=${this.userId}`).subscribe(a=>{let t=a.map(s=>s.contribution_id);this.http.get("http://localhost:3000/contributions").subscribe(s=>{this.http.get("http://localhost:3000/bills").subscribe(b=>{this.statusList=a.map(m=>{let p=s.find(c=>c.id===m.contribution_id),l=b.find(c=>c.id===p?.bill_id);return{descripcionFactura:l?.descripcion,montoFactura:l?.monto,fechaFactura:l?.fecha,descripcionContrib:p?.descripcion,strategy:p?.strategy,fechaLimite:p?.fecha_limite,monto:m.monto,status:m.status,pagadoEn:m.pagado_en}})})})})}static \u0275fac=function(t){return new(t||o)(_(y))};static \u0275cmp=C({type:o,selectors:[["app-memb-status"]],standalone:!1,decls:5,vars:4,consts:[[1,"p-4","max-w-screen-lg","mx-auto"],["header","Estado de mis contribuciones"],[3,"value","paginator","rows","responsiveLayout"],["pTemplate","header"],["pTemplate","body"],[1,"badge",3,"ngClass"]],template:function(t,s){t&1&&(i(0,"div",0)(1,"p-card",1)(2,"p-table",2),f(3,Tt,15,0,"ng-template",3)(4,Dt,19,19,"ng-template",4),e()()()),t&2&&(r(2),d("value",s.statusList)("paginator",!0)("rows",5)("responsiveLayout","scroll"))},dependencies:[v,B,M,W,E,A],encapsulation:2})};var Ft=()=>({label:"Espa\xF1ol",value:"es"}),Ot=()=>({label:"Ingl\xE9s",value:"en"}),Ht=(o,a)=>[o,a],J=class o{constructor(a){this.http=a}userId;settings={language:"es",dark_mode:!1,notifications_enabled:!0};settingsId;ngOnInit(){let a=JSON.parse(localStorage.getItem("currentUser"));this.userId=+a.id,this.http.get(`http://localhost:3000/settings?user_id=${this.userId}`).subscribe(t=>{t.length>0&&(this.settings=N({},t[0]),this.settingsId=t[0].id)})}save(){this.http.patch(`http://localhost:3000/settings/${this.settingsId}`,this.settings).subscribe(()=>{alert("Preferencias actualizadas correctamente.")})}static \u0275fac=function(t){return new(t||o)(_(y))};static \u0275cmp=C({type:o,selectors:[["app-memb-settings"]],standalone:!1,decls:17,vars:9,consts:[[1,"p-4","max-w-screen-sm","mx-auto"],["header","Configuraci\xF3n de usuario"],[1,"grid","formgrid","p-fluid",3,"ngSubmit"],[1,"field","col-12"],["for","language"],["inputId","language","name","language","placeholder","Selecciona un idioma",3,"ngModelChange","ngModel","options"],[1,"field-checkbox","col-12"],["name","dark_mode","binary","true",3,"ngModelChange","ngModel"],["for","dark_mode"],["name","notifications_enabled","binary","true",3,"ngModelChange","ngModel"],["for","notifications_enabled"],[1,"col-12","mt-3"],["pButton","","type","submit","label","Guardar",1,"p-button-primary","w-full"]],template:function(t,s){t&1&&(i(0,"div",0)(1,"p-card",1)(2,"form",2),F("ngSubmit",function(){return s.save()}),i(3,"div",3)(4,"label",4),n(5,"Idioma"),e(),i(6,"p-dropdown",5),k("ngModelChange",function(m){return H(s.settings.language,m)||(s.settings.language=m),m}),e()(),i(7,"div",6)(8,"p-checkbox",7),k("ngModelChange",function(m){return H(s.settings.dark_mode,m)||(s.settings.dark_mode=m),m}),e(),i(9,"label",8),n(10,"Modo oscuro"),e()(),i(11,"div",6)(12,"p-checkbox",9),k("ngModelChange",function(m){return H(s.settings.notifications_enabled,m)||(s.settings.notifications_enabled=m),m}),e(),i(13,"label",10),n(14,"Recibir notificaciones"),e()(),i(15,"div",11),D(16,"button",12),e()()()()),t&2&&(r(6),O("ngModel",s.settings.language),d("options",I(6,Ht,z(4,Ft),z(5,Ot))),r(2),O("ngModel",s.settings.dark_mode),r(4),O("ngModel",s.settings.notifications_enabled))},dependencies:[ot,M,pt,lt,at,rt,mt,st,dt],encapsulation:2})};var kt=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",component:G},{path:"contributions",component:j},{path:"status",component:$},{path:"settings",component:J}],U=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=T({type:o});static \u0275inj=P({imports:[q.forChild(kt),q]})};var ht=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=T({type:o});static \u0275inj=P({imports:[nt,U,ct,ut]})};export{ht as MemberModule};
