import{a as X,b as K}from"./chunk-G3PSCGIT.js";import{a as z}from"./chunk-MGQZOIFY.js";import{a as W}from"./chunk-IB4BDQBE.js";import"./chunk-BSM3DYXS.js";import{a as L,b as m,c as V,d as O,f as k,g as M,h as U,i as A,j as q,k as G,l as j,m as B,o as $,p as H,q as J}from"./chunk-2K3ZRB22.js";import{f as R,g as T}from"./chunk-H4ACMJDA.js";import"./chunk-FKPM6TIP.js";import{$a as n,Da as F,Ia as b,Oa as d,Qa as i,Ra as e,Sa as x,Ta as g,Ua as C,Va as _,Wa as u,Y as f,Z as v,ab as E,bb as p,db as N,eb as D,fb as P,ua as o,za as h}from"./chunk-GUCOMCN7.js";import{a as w}from"./chunk-2NFLSA4Y.js";function ee(a,r){if(a&1&&(i(0,"option",23),n(1),e()),a&2){let t=r.$implicit;u("value",t.id),o(),p(" ",t.name," ")}}function te(a,r){if(a&1){let t=g();i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),e(),i(7,"td"),n(8),e(),i(9,"td"),n(10),e(),i(11,"td")(12,"div",24)(13,"span",25),C("click",function(){let s=f(t).$implicit,c=_();return v(c.editTable(s))}),n(14,"Edit"),e(),i(15,"span",26),C("click",function(){let s=f(t).$implicit,c=_();return v(c.deleteContribution(s.id))}),n(16,"Delete"),e()()()()}if(a&2){let t=r.$implicit;o(2),E(t.descripcion),o(2),E(t.memberName),o(2),E(t.amount),o(2),E(t.currency),o(2),E(t.status)}}function ie(a,r){if(a&1&&(i(0,"option",23),n(1),e()),a&2){let t=r.$implicit;u("value",t.id),o(),p(" ",t.firstName+" "+t.lastName," ")}}function ne(a,r){if(a&1&&(i(0,"form",27)(1,"div")(2,"label",28),n(3,"Select User"),e(),i(4,"select",29),b(5,ie,2,2,"option",6),e()(),i(6,"div")(7,"label",30),n(8,"Descripcion"),e(),x(9,"input",31),e(),i(10,"div")(11,"label",32),n(12,"Amount"),e(),x(13,"input",33),e(),i(14,"div")(15,"label",34),n(16,"currency"),e(),i(17,"select",35)(18,"option"),n(19,"--selection currency---"),e(),i(20,"option",36),n(21,"PEN"),e(),i(22,"option",37),n(23,"USD"),e()()(),i(24,"div")(25,"label",38),n(26,"status"),e(),i(27,"select",39)(28,"option",23),n(29),e(),i(30,"option",23),n(31),e(),i(32,"option",23),n(33),e(),i(34,"option",23),n(35),e(),i(36,"option",23),n(37),e()()()()),a&2){let t=_();d("formGroup",t.contributionForm),o(5),d("ngForOf",t.memberList),o(23),u("value",t.statusEnum.PENDING),o(),p(" ",t.statusEnum.PENDING," "),o(),u("value",t.statusEnum.APPROVED),o(),p(" ",t.statusEnum.APPROVED," "),o(),u("value",t.statusEnum.REJECTED),o(),p(" ",t.statusEnum.REJECTED," "),o(),u("value",t.statusEnum.CANCELLED),o(),p(" ",t.statusEnum.CANCELLED," "),o(),u("value",t.statusEnum.EXPIRED),o(),p(" ",t.statusEnum.EXPIRED," ")}}function re(a,r){if(a&1){let t=g();i(0,"span",40),C("click",function(){f(t);let s=_();return v(s.initform())}),n(1,"Create"),e()}}function oe(a,r){if(a&1){let t=g();i(0,"span",41),C("click",function(){f(t);let s=_();return v(s.initform())}),n(1,"cancel"),e()}}function ae(a,r){if(a&1){let t=g();i(0,"span",40),C("click",function(){f(t);let s=_();return v(s.saveContribution())}),n(1,"save"),e()}}function le(a,r){a&1&&(i(0,"div",42),x(1,"br")(2,"br")(3,"br"),i(4,"h1",8),n(5,"!!!Please Select a Period"),e()())}var Q=class a{constructor(r,t,l,s){this._periodServices=r;this._contributionService=t;this._memberService=l;this.fb=s;let c=localStorage.getItem("currentUser"),Y=localStorage.getItem("currentHouse"),S=JSON.parse(c||"");this.represent=S,this.house_id=Y||"",this.user_id=S?S.id:"",this._periodServices.getAll("owner_id="+this.user_id+"&house_id="+this.house_id).subscribe({next:Z=>{this.periodList=Z,this.period_id=this.periodList.filter(y=>{let I=new Date;return new Date(y.dateInit)<=I&&new Date(y.dateDue)>=I})[0].id||"0"}}),this.initFormclean(),this.loadData()}user_id;represent;house_id;periodList;period_id;contributionsList;memberList;contributionForm;activateForm;activateFormEdit;statusEnum=X;initFormclean(){this.contributionForm=this.fb.group({user_id:["",m.required],descripcion:["",m.required],amount:[0,m.required],currency:["",m.required],status:["pending",m.required],id:[""],is_billing:[!1]})}ngOnInit(){console.log("hola")}loadData(){this._contributionService.getAllByHouseNotBilling(this.house_id).subscribe({next:r=>{this.contributionsList=r,this._memberService.getAllByHouse(this.house_id).subscribe({next:t=>{this.memberList=[this.represent,...t],this.contributionsList=this.contributionsList.map(l=>{let s=this.memberList.find(c=>c.id==l.user_id)||{};return w({memberName:s.firstName+" "+s.lastName},l)})},error:t=>{alert("Failed data list member")}})},error:r=>{alert("Failed data list contribution")}})}initform(){this.activateForm=!this.activateForm,this.initFormclean(),this.activateFormEdit=!1}editTable(r){this.contributionForm=this.fb.group({user_id:[r.user_id,m.required],descripcion:[r.descripcion,m.required],amount:[r.amount,m.required],currency:[r.currency,m.required],status:[r.status,m.required],id:[r.id],is_billing:[r.is_billing,m.required]}),this.activateForm=!0,this.activateFormEdit=!0}saveContribution(){let r=this.contributionForm.value;this.contributionForm.valid?r.id?this._contributionService.update(r.id,r.user_id,r.descripcion,r.amount,r.currency,this.house_id,this.period_id,r.status,r.is_billing).subscribe({next:t=>{this.loadData(),this.initform()},error:t=>{alert("error update Contribution "+r.descripcion)}}):this._contributionService.create(this.user_id,r.descripcion,r.amount,r.user_id,r.currency,this.house_id,this.period_id,r.is_billing).subscribe({next:t=>{this.initform(),this.loadData()},error:t=>{alert("error create Contribution")}}):alert("data not valid")}deleteContribution(r){this._contributionService.delete(r).subscribe({next:t=>{this.loadData()},error:t=>{alert("error delete Contribution ")}})}static \u0275fac=function(t){return new(t||a)(h(z),h(K),h(W),h($))};static \u0275cmp=F({type:a,selectors:[["app-repre-contributions"]],decls:61,vars:9,consts:[[1,"container","p-0"],[1,"border-bottom",2,"display","flex","justify-content","space-between"],[1,"text-white","mb-3"],["for","selectPeriod",1,"text-white"],["name","selectPeriod",1,"form-select",2,"width","auto",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-5"],[1,"text-white"],[1,"d-flex","justify-content-evenly","flex-wrap","gap-3","mt-5"],[1,"card","p-4","card-amount"],[1,"container-form","mt-3"],[1,"card","p-4","w-100"],[1,"table-responsive"],[1,"table","table-bordered","table-striped"],[1,"table-dark"],[4,"ngFor","ngForOf"],[1,"card","p-4"],["class","row row-cols-2 g-3",3,"formGroup",4,"ngIf"],["class","btn btn-success w-100 mt-3",3,"click",4,"ngIf"],[1,"d-flex",2,"column-gap","16px"],["class","btn btn-danger w-100 mt-3",3,"click",4,"ngIf"],["class","w-100 text-center mt-5",4,"ngIf"],[3,"value"],[1,"d-flex",2,"column-gap","10px"],[1,"btn","btn-primary","w-100",3,"click"],[1,"btn","btn-danger","w-100",3,"click"],[1,"row","row-cols-2","g-3",3,"formGroup"],["for","user_id",1,"form-label"],["formControlName","user_id",1,"form-control"],["for","descripcion",1,"form-label"],["type","text","formControlName","descripcion",1,"form-control"],["for","amount",1,"form-label"],["type","number","formControlName","amount",1,"form-control"],["for","currency",1,"form-label"],["formControlName","currency",1,"form-control"],["value","PEN"],["value","USD"],["for","status",1,"form-label"],["formControlName","status",1,"form-control"],[1,"btn","btn-success","w-100","mt-3",3,"click"],[1,"btn","btn-danger","w-100","mt-3",3,"click"],[1,"w-100","text-center","mt-5"]],template:function(t,l){t&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),n(3,"Contributions"),e(),i(4,"div")(5,"label",3),n(6,"Select Period"),e(),i(7,"select",4),P("ngModelChange",function(c){return D(l.period_id,c)||(l.period_id=c),c}),i(8,"option",5),n(9,"--Select Period--"),e(),b(10,ee,2,2,"option",6),e()()(),i(11,"section",7)(12,"h3",8),n(13,"House: Casa chorrillos"),e(),i(14,"div",9)(15,"div",10)(16,"h1"),n(17,"150$"),e(),i(18,"span"),n(19,"Total collected"),e()(),i(20,"div",10)(21,"h1"),n(22,"50$"),e(),i(23,"span"),n(24,"Total shortfall"),e()(),i(25,"div",10)(26,"h1"),n(27,"200$"),e(),i(28,"span"),n(29,"Total"),e()()(),i(30,"div",11)(31,"div",12)(32,"legend"),n(33,"List the contributions by Casa chorrillos"),e(),i(34,"div",13)(35,"table",14)(36,"thead",15)(37,"tr")(38,"th"),n(39,"Descripcion"),e(),i(40,"th"),n(41,"Member"),e(),i(42,"th"),n(43,"Amount"),e(),i(44,"th"),n(45,"Currency"),e(),i(46,"th"),n(47,"Status"),e(),x(48,"th"),e()(),i(49,"tbody"),b(50,te,17,5,"tr",16),e()()()(),i(51,"div",17)(52,"legend"),n(53),e(),b(54,ne,38,12,"form",18)(55,re,2,0,"span",19),i(56,"div",20),b(57,oe,2,0,"span",21)(58,ae,2,0,"span",19),e()()()(),b(59,le,6,0,"div",22),x(60,"section"),e()),t&2&&(o(7),N("ngModel",l.period_id),o(3),d("ngForOf",l.periodList),o(40),d("ngForOf",l.contributionsList),o(3),p("",l.activateFormEdit?"Edit":"Create"," contribution"),o(),d("ngIf",l.activateForm),o(),d("ngIf",!l.activateForm),o(2),d("ngIf",l.activateForm),o(),d("ngIf",l.activateForm),o(),d("ngIf",l.period_id=="0"))},dependencies:[R,H,M,j,B,L,U,G,V,O,k,T,J,A,q],styles:[".card-amount[_ngcontent-%COMP%]{max-width:180px;height:160px;width:100%;text-align:center;display:flex;flex-direction:column;align-items:center;align-content:center;justify-content:center}.card-amount[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;margin-bottom:0}.card-amount[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#5c5c5c;font-weight:600}"]})};export{Q as RepreContributionsComponent};
