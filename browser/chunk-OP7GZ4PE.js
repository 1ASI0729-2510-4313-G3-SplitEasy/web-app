import{a as U}from"./chunk-W5VXLQ2X.js";import{a as D}from"./chunk-IB4BDQBE.js";import"./chunk-BB3PY2CE.js";import"./chunk-BSM3DYXS.js";import{a as C,b as a,c as y,d as M,g as R,h as I,i as V,j as k,o as q,q as T}from"./chunk-2K3ZRB22.js";import{f as w,g as N}from"./chunk-H4ACMJDA.js";import"./chunk-FKPM6TIP.js";import{$a as n,Da as F,Ia as g,Oa as p,Qa as i,Ra as e,Sa as s,Ta as _,Ua as f,Va as d,Y as u,Z as b,ab as x,bb as S,ua as l,za as h}from"./chunk-GUCOMCN7.js";import"./chunk-2NFLSA4Y.js";function L(o,t){if(o&1){let r=_();i(0,"tr")(1,"td"),n(2),e(),i(3,"td"),n(4),e(),i(5,"td"),n(6),e(),i(7,"td"),n(8),e(),i(9,"td")(10,"div",14)(11,"span",15),f("click",function(){let c=u(r).$implicit,v=d();return b(v.editTable(c))}),n(12,"Edit"),e(),i(13,"span",16),f("click",function(){let c=u(r).$implicit,v=d();return b(v.deleteMember(c.id))}),n(14,"Delete"),e()()()()}if(o&2){let r=t.$implicit;l(2),x(r.firstName),l(2),x(r.lastName),l(2),x(r.email),l(2),x(r.salary)}}function A(o,t){if(o&1&&(i(0,"form",17)(1,"div")(2,"div")(3,"label",18),n(4,"First Name"),e(),s(5,"input",19),e(),i(6,"div",20)(7,"label",21),n(8,"Last Name"),e(),s(9,"input",22),e()(),i(10,"div")(11,"label",23),n(12,"Email"),e(),s(13,"input",24),e(),i(14,"div",20)(15,"label",25),n(16,"Salary"),e(),s(17,"input",26),e()()),o&2){let r=d();p("formGroup",r.memberEditForm)}}function B(o,t){if(o&1&&(i(0,"form",27)(1,"div")(2,"label",18),n(3,"First Name"),e(),s(4,"input",19),e(),i(5,"div")(6,"label",21),n(7,"Last Name"),e(),s(8,"input",22),e(),i(9,"div",20)(10,"label",25),n(11,"Salary"),e(),s(12,"input",26),e(),i(13,"div")(14,"label",23),n(15,"Email"),e(),s(16,"input",24),e(),i(17,"div")(18,"label",28),n(19,"Password"),e(),s(20,"input",29),e(),i(21,"div")(22,"label",30),n(23,"Repeat Password"),e(),s(24,"input",31),e()()),o&2){let r=d();p("formGroup",r.memberRegisterForm)}}function P(o,t){if(o&1){let r=_();i(0,"span",32),f("click",function(){u(r);let c=d();return b(c.activeForm())}),n(1,"Create"),e()}}function j(o,t){if(o&1){let r=_();i(0,"span",33),f("click",function(){u(r);let c=d();return b(c.initform())}),n(1,"cancel"),e()}}function O(o,t){if(o&1){let r=_();i(0,"span",32),f("click",function(){u(r);let c=d();return b(c.saveMember())}),n(1,"save"),e()}}var G=class o{constructor(t,r,m){this._memberService=t;this.fb=r;this._authService=m;let c=localStorage.getItem("currentUser"),v=localStorage.getItem("currentHouse"),E=JSON.parse(c||"");this.house_id=v||"",this.user_id=E?E.id:"",this.user_id=E?E.id:"",this.initForms(),this.loadData()}user_id;house_id;membersList;activateForm;activateFormEdit;memberEditForm;memberRegisterForm;initForms(){this.memberEditForm=this.fb.group({id:[],firstName:["",[a.required]],lastName:["",[a.required]],email:["",[a.required,a.email]],salary:[0,[a.required,a.min(0)]]}),this.memberRegisterForm=this.fb.group({email:["",[a.required,a.email]],firstName:["",[a.required]],lastName:["",[a.required]],password:["",[a.required]],repeatPassword:["",[a.required]],salary:[0,[a.required,a.min(0)]],role:["member",[a.required]]})}loadData(){this._memberService.getAllByHouse(this.house_id).subscribe({next:t=>{this.membersList=t},error:t=>{alert("Failed data list member")}})}initform(){this.activateForm=!1,this.initForms(),this.activateFormEdit=!1}activeForm(){this.activateForm=!0,this.initForms(),this.activateFormEdit=!1}editTable(t){this.memberEditForm=this.fb.group({id:[t.id],firstName:[t.firstName,[a.required]],lastName:[t.lastName,[a.required]],salary:[t.salary,[a.required,a.min(0)]],email:[t.email,[a.required,a.email]]}),this.activateFormEdit=!0}editMember(){let t=this.memberEditForm.value;this.memberEditForm.valid?this._memberService.updateUser(t.id,t.email,"member",t.firstName,t.lastName,t.salary).subscribe({next:r=>{this.loadData(),this.initform()},error:r=>{alert("error update member "+t.firstName)}}):alert("data not valid")}registerMember(){let t=this.memberRegisterForm.value;this.memberRegisterForm.valid&&t.password===t.repeatPassword?this._authService.existUser(t.email).subscribe({next:r=>{r.length==0?this._authService.register(t).subscribe({next:m=>{this.loadData(),this.initform()},error:m=>{console.log(m)}}):alert("this is email exist!!")},error:r=>{alert("Error in database")}}):alert("password diff register password or fields incomplet")}saveMember(){this.memberEditForm.value.id?this.editMember():this.registerMember()}deleteMember(t){this._memberService.deleteById(t).subscribe({next:r=>{this.loadData()},error:r=>{alert("error delete member ")}})}static \u0275fac=function(r){return new(r||o)(h(D),h(q),h(U))};static \u0275cmp=F({type:o,selectors:[["app-repre-member"]],decls:32,vars:7,consts:[[1,"container","p-0"],[1,"text-white","mb-3"],[1,"row",2,"column-gap","16px"],[1,"card","p-4","col-7"],[1,"table-responsive"],[1,"table","table-bordered","table-striped"],[1,"table-dark"],[4,"ngFor","ngForOf"],[1,"card","p-4","col-4"],["class","row row-cols-1 g-3",3,"formGroup",4,"ngIf"],["class","row row-cols-2 g-3",3,"formGroup",4,"ngIf"],["class","btn btn-success w-100 mt-3",3,"click",4,"ngIf"],[1,"d-flex",2,"column-gap","16px"],["class","btn btn-danger w-100 mt-3",3,"click",4,"ngIf"],[1,"d-flex",2,"column-gap","10px"],[1,"btn","btn-primary","w-100",3,"click"],[1,"btn","btn-danger","w-100",3,"click"],[1,"row","row-cols-1","g-3",3,"formGroup"],["for","firstName",1,"form-label"],["type","text","formControlName","firstName",1,"form-control"],[1,"ml-2"],["for","lastName",1,"form-label"],["type","text","formControlName","lastName",1,"form-control"],["for","email",1,"form-label"],["type","email","formControlName","email","placeholder","ejemplo@correo.com",1,"form-control"],["for","salary",1,"form-label"],["type","number","formControlName","salary",1,"form-control"],[1,"row","row-cols-2","g-3",3,"formGroup"],["for","password",1,"form-label"],["type","password","formControlName","password","placeholder","********",1,"form-control"],["for","repeat-password",1,"form-label"],["type","password","formControlName","repeatPassword","placeholder","********",1,"form-control"],[1,"btn","btn-success","w-100","mt-3",3,"click"],[1,"btn","btn-danger","w-100","mt-3",3,"click"]],template:function(r,m){r&1&&(i(0,"div",0)(1,"h1",1),n(2,"Member"),e(),i(3,"section")(4,"div",2)(5,"div",3)(6,"legend"),n(7,"List the members"),e(),i(8,"div",4)(9,"table",5)(10,"thead",6)(11,"tr")(12,"th"),n(13,"First Name"),e(),i(14,"th"),n(15,"Last Name"),e(),i(16,"th"),n(17,"Email"),e(),i(18,"th"),n(19,"Salary"),e(),s(20,"th"),e()(),i(21,"tbody"),g(22,L,15,4,"tr",7),e()()()(),i(23,"div",8)(24,"legend"),n(25),e(),g(26,A,18,1,"form",9)(27,B,25,1,"form",10)(28,P,2,0,"span",11),i(29,"div",12),g(30,j,2,0,"span",13)(31,O,2,0,"span",11),e()()()()()),r&2&&(l(22),p("ngForOf",m.membersList),l(3),S("",m.activateFormEdit?"Edit":"Create"," member"),l(),p("ngIf",m.activateFormEdit),l(),p("ngIf",m.activateForm),l(),p("ngIf",!m.activateForm&&!m.activateFormEdit),l(2),p("ngIf",m.activateForm||m.activateFormEdit),l(),p("ngIf",m.activateForm||m.activateFormEdit))},dependencies:[w,N,T,R,C,I,y,M,V,k],encapsulation:2})};export{G as RepreMemberComponent};
