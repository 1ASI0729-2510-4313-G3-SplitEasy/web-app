import{a as K,b as Y}from"./chunk-G3PSCGIT.js";import{a as Q}from"./chunk-MGQZOIFY.js";import{a as z}from"./chunk-IB4BDQBE.js";import"./chunk-BSM3DYXS.js";import{a as V,b as s,c as O,d as k,f as q,g as G,h as A,i as M,j as U,k as j,l as $,m as J,o as H,p as X,q as W}from"./chunk-2K3ZRB22.js";import{f as L,g as T}from"./chunk-H4ACMJDA.js";import"./chunk-FKPM6TIP.js";import{$a as i,Da as w,Ia as _,Oa as u,Qa as t,Ra as e,Sa as b,Ta as I,Ua as E,Va as f,Wa as p,Y as h,Z as x,ab as S,bb as c,db as P,eb as B,fb as R,ua as o,za as C}from"./chunk-GUCOMCN7.js";import{a as N}from"./chunk-2NFLSA4Y.js";function ee(a,r){if(a&1&&(t(0,"option",24),i(1),e()),a&2){let n=r.$implicit;p("value",n.id),o(),c(" ",n.name," ")}}function te(a,r){if(a&1){let n=I();t(0,"tr")(1,"td"),i(2),e(),t(3,"td"),i(4),e(),t(5,"td"),i(6),e(),t(7,"td"),i(8),e(),t(9,"td"),i(10),e(),t(11,"td")(12,"div",37)(13,"span",38),E("click",function(){let m=h(n).$implicit,d=f();return x(d.editTable(m))}),i(14,"Edit"),e(),t(15,"span",39),E("click",function(){let m=h(n).$implicit,d=f();return x(d.deleteContribution(m.id))}),i(16,"Delete"),e()()()()}if(a&2){let n=r.$implicit;o(2),S(n.descripcion),o(2),S(n.memberName),o(2),S(n.amount),o(2),S(n.currency),o(2),S(n.status)}}function ie(a,r){if(a&1&&(t(0,"option",24),i(1),e()),a&2){let n=r.$implicit;p("value",n.id),o(),c(" ",n.firstName+" "+n.lastName," ")}}function ne(a,r){if(a&1&&(t(0,"form",13)(1,"div")(2,"label",40),i(3,"Select User"),e(),t(4,"select",41),_(5,ie,2,2,"option",6),e()(),t(6,"div")(7,"label",14),i(8,"Descripcion"),e(),b(9,"input",15),e(),t(10,"div")(11,"label",16),i(12,"Amount"),e(),b(13,"input",17),e(),t(14,"div")(15,"label",18),i(16,"currency"),e(),t(17,"select",19)(18,"option"),i(19,"--selection currency---"),e(),t(20,"option",20),i(21,"PEN"),e(),t(22,"option",21),i(23,"USD"),e()()(),t(24,"div")(25,"label",22),i(26,"status"),e(),t(27,"select",23)(28,"option",24),i(29),e(),t(30,"option",24),i(31),e(),t(32,"option",24),i(33),e(),t(34,"option",24),i(35),e(),t(36,"option",24),i(37),e()()()()),a&2){let n=f();u("formGroup",n.contributionForm),o(5),u("ngForOf",n.memberList),o(23),p("value",n.statusEnum.PENDING),o(),c(" ",n.statusEnum.PENDING," "),o(),p("value",n.statusEnum.APPROVED),o(),c(" ",n.statusEnum.APPROVED," "),o(),p("value",n.statusEnum.REJECTED),o(),c(" ",n.statusEnum.REJECTED," "),o(),p("value",n.statusEnum.CANCELLED),o(),c(" ",n.statusEnum.CANCELLED," "),o(),p("value",n.statusEnum.EXPIRED),o(),c(" ",n.statusEnum.EXPIRED," ")}}function re(a,r){if(a&1){let n=I();t(0,"span",25),E("click",function(){h(n);let m=f();return x(m.initform())}),i(1,"Create"),e()}}function oe(a,r){if(a&1){let n=I();t(0,"span",42),E("click",function(){h(n);let m=f();return x(m.initform())}),i(1,"cancel"),e()}}function le(a,r){if(a&1){let n=I();t(0,"span",25),E("click",function(){h(n);let m=f();return x(m.saveContribution())}),i(1,"save"),e()}}function ae(a,r){a&1&&(t(0,"div",43),b(1,"br")(2,"br")(3,"br"),t(4,"h1",8),i(5,"!!!Please Select a Period"),e()())}var Z=class a{constructor(r,n,l,m){this._periodServices=r;this._contributionService=n;this._memberService=l;this.fb=m;let d=localStorage.getItem("currentUser"),g=localStorage.getItem("currentHouse"),v=JSON.parse(d||"");this.represent=v,this.house_id=g||"",this.user_id=v?v.id:"",this._periodServices.getAll("owner_id="+this.user_id+"&house_id="+this.house_id).subscribe({next:F=>{this.periodList=F,this.period_id=this.periodList.filter(y=>{let D=new Date;return new Date(y.dateInit)<=D&&new Date(y.dateDue)>=D})[0].id||"0"}}),this.BillisForm=this.fb.group({descripcion:["",s.required],amount:[0,s.required],currency:["",s.required],status:["pending",s.required],is_billing:[!0]}),this.initFormclean(),this.loadData()}user_id;house_id;periodList;period_id;contributionsList;memberList;contributionForm;BillisForm;activateForm;activateFormEdit;statusEnum=K;represent;initFormclean(){this.contributionForm=this.fb.group({user_id:["",s.required],descripcion:["",s.required],amount:[0,s.required],currency:["",s.required],status:["pending",s.required],id:[""],is_billing:[!0]})}ngOnInit(){console.log("hola")}loadData(){this._contributionService.getAllByHouseIsBilling(this.house_id).subscribe({next:r=>{this.contributionsList=r,this._memberService.getAllByHouse(this.house_id).subscribe({next:n=>{this.memberList=[this.represent,...n],this.contributionsList=this.contributionsList.map(l=>{let m=this.memberList.find(d=>d.id==l.user_id)||{};return N({memberName:m.firstName+" "+m.lastName},l)})},error:n=>{alert("Failed data list member")}})},error:r=>{alert("Failed data list contribution")}})}initform(){this.activateForm=!this.activateForm,this.initFormclean(),this.activateFormEdit=!1}editTable(r){this.contributionForm=this.fb.group({user_id:[r.user_id,s.required],descripcion:[r.descripcion,s.required],amount:[r.amount,s.required],currency:[r.currency,s.required],status:[r.status,s.required],id:[r.id],is_billing:[r.is_billing,s.required]}),this.activateForm=!0,this.activateFormEdit=!0}saveContribution(){let r=this.contributionForm.value;this.contributionForm.valid?r.id?this._contributionService.update(r.id,r.user_id,r.descripcion,r.amount,r.currency,this.house_id,this.period_id,r.status,r.is_billing).subscribe({next:n=>{this.loadData(),this.initform()},error:n=>{alert("error update Contribution "+r.descripcion)}}):this._contributionService.create(this.user_id,r.descripcion,r.amount,r.user_id,r.currency,this.house_id,this.period_id,r.is_billing).subscribe({next:n=>{this.initform(),this.loadData()},error:n=>{alert("error create Contribution")}}):alert("data not valid")}deleteContribution(r){this._contributionService.delete(r).subscribe({next:n=>{this.loadData()},error:n=>{alert("error delete Contribution ")}})}generateBillis(){let r=this.BillisForm.value;this.BillisForm.valid?this.prorratearBillis(r.amount,r.descripcion,r.currency):alert("campos incorrectos")}prorratearBillis(r,n,l){let m=this.memberList,d=m.reduce((g,v)=>g+v.salary,0);m.forEach(g=>{let v=g.salary/d,F=parseFloat((r*v).toFixed(2));this._contributionService.create(this.user_id,n,F,g.id,l,this.house_id,this.period_id,!0).subscribe({next:y=>{this.BillisForm=this.fb.group({descripcion:["",s.required],amount:[0,s.required],currency:["",s.required],status:["pending",s.required],is_billing:[!0]})},error:y=>{alert("error create Contribution")}})}),this.loadData()}static \u0275fac=function(n){return new(n||a)(C(Q),C(Y),C(z),C(H))};static \u0275cmp=w({type:a,selectors:[["app-repre-billing"]],decls:100,vars:20,consts:[[1,"container","p-0"],[1,"border-bottom",2,"display","flex","justify-content","space-between"],[1,"text-white","mb-3"],["for","selectPeriod",1,"text-white"],["name","selectPeriod",1,"form-select",2,"width","auto",3,"ngModelChange","ngModel"],["value","0"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-5"],[1,"text-white"],[1,"d-flex","justify-content-evenly","flex-wrap","gap-3","mt-5"],[1,"card","p-4","card-amount"],[1,"container"],[1,"card","p-4"],[1,"row","row-cols-2","g-3",3,"formGroup"],["for","descripcion",1,"form-label"],["type","text","formControlName","descripcion",1,"form-control"],["for","amount",1,"form-label"],["type","number","formControlName","amount",1,"form-control"],["for","currency",1,"form-label"],["formControlName","currency",1,"form-control"],["value","PEN"],["value","USD"],["for","status",1,"form-label"],["formControlName","status",1,"form-control"],[3,"value"],[1,"btn","btn-success","w-100","mt-3",3,"click"],[1,"container-form","mt-3"],[1,"card","p-4","w-100"],[1,"table-responsive"],[1,"table","table-bordered","table-striped"],[1,"table-dark"],[4,"ngFor","ngForOf"],["class","row row-cols-2 g-3",3,"formGroup",4,"ngIf"],["class","btn btn-success w-100 mt-3",3,"click",4,"ngIf"],[1,"d-flex",2,"column-gap","16px"],["class","btn btn-danger w-100 mt-3",3,"click",4,"ngIf"],["class","w-100 text-center mt-5",4,"ngIf"],[1,"d-flex",2,"column-gap","10px"],[1,"btn","btn-primary","w-100",3,"click"],[1,"btn","btn-danger","w-100",3,"click"],["for","user_id",1,"form-label"],["formControlName","user_id",1,"form-control"],[1,"btn","btn-danger","w-100","mt-3",3,"click"],[1,"w-100","text-center","mt-5"]],template:function(n,l){n&1&&(t(0,"div",0)(1,"div",1)(2,"h1",2),i(3,"Billis"),e(),t(4,"div")(5,"label",3),i(6,"Select Period"),e(),t(7,"select",4),R("ngModelChange",function(d){return B(l.period_id,d)||(l.period_id=d),d}),t(8,"option",5),i(9,"--Select Period--"),e(),_(10,ee,2,2,"option",6),e()()(),t(11,"section",7)(12,"h3",8),i(13,"House: Casa chorrillos"),e(),t(14,"div",9)(15,"div",10)(16,"h1"),i(17,"150$"),e(),t(18,"span"),i(19,"Total collected"),e()(),t(20,"div",10)(21,"h1"),i(22,"50$"),e(),t(23,"span"),i(24,"Total shortfall"),e()(),t(25,"div",10)(26,"h1"),i(27,"200$"),e(),t(28,"span"),i(29,"Total"),e()()(),t(30,"div",11)(31,"div",12)(32,"legend"),i(33,"Generate Billis all member"),e(),t(34,"form",13)(35,"div")(36,"label",14),i(37,"Descripcion"),e(),b(38,"input",15),e(),t(39,"div")(40,"label",16),i(41,"Amount"),e(),b(42,"input",17),e(),t(43,"div")(44,"label",18),i(45,"currency"),e(),t(46,"select",19)(47,"option"),i(48,"--selection currency---"),e(),t(49,"option",20),i(50,"PEN"),e(),t(51,"option",21),i(52,"USD"),e()()(),t(53,"div")(54,"label",22),i(55,"status"),e(),t(56,"select",23)(57,"option",24),i(58),e(),t(59,"option",24),i(60),e(),t(61,"option",24),i(62),e(),t(63,"option",24),i(64),e(),t(65,"option",24),i(66),e()()()(),t(67,"span",25),E("click",function(){return l.generateBillis()}),i(68,"Generate"),e()()(),t(69,"div",26)(70,"div",27)(71,"legend"),i(72,"List the Billis by Casa chorrillos"),e(),t(73,"div",28)(74,"table",29)(75,"thead",30)(76,"tr")(77,"th"),i(78,"Descripcion"),e(),t(79,"th"),i(80,"Member"),e(),t(81,"th"),i(82,"Amount"),e(),t(83,"th"),i(84,"Currency"),e(),t(85,"th"),i(86,"Status"),e(),b(87,"th"),e()(),t(88,"tbody"),_(89,te,17,5,"tr",31),e()()()(),t(90,"div",12)(91,"legend"),i(92),e(),_(93,ne,38,12,"form",32)(94,re,2,0,"span",33),t(95,"div",34),_(96,oe,2,0,"span",35)(97,le,2,0,"span",33),e()()()(),_(98,ae,6,0,"div",36),b(99,"section"),e()),n&2&&(o(7),P("ngModel",l.period_id),o(3),u("ngForOf",l.periodList),o(24),u("formGroup",l.BillisForm),o(23),p("value",l.statusEnum.PENDING),o(),c(" ",l.statusEnum.PENDING," "),o(),p("value",l.statusEnum.APPROVED),o(),c(" ",l.statusEnum.APPROVED," "),o(),p("value",l.statusEnum.REJECTED),o(),c(" ",l.statusEnum.REJECTED," "),o(),p("value",l.statusEnum.CANCELLED),o(),c(" ",l.statusEnum.CANCELLED," "),o(),p("value",l.statusEnum.EXPIRED),o(),c(" ",l.statusEnum.EXPIRED," "),o(23),u("ngForOf",l.contributionsList),o(3),c("",l.activateFormEdit?"Edit":"Create"," contribution"),o(),u("ngIf",l.activateForm),o(),u("ngIf",!l.activateForm),o(2),u("ngIf",l.activateForm),o(),u("ngIf",l.activateForm),o(),u("ngIf",l.period_id=="0"))},dependencies:[L,X,G,$,J,V,A,j,O,k,q,T,W,M,U],styles:[".card-amount[_ngcontent-%COMP%]{max-width:180px;height:160px;width:100%;text-align:center;display:flex;flex-direction:column;align-items:center;align-content:center;justify-content:center}.card-amount[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-weight:700;margin-bottom:0}.card-amount[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#5c5c5c;font-weight:600}"]})};export{Z as RepreBillingComponent};
